# Tests for CT TFA benefit calculation
# Benefit = payment_standard - countable_unearned_income
# High earner (>= 171% FPG): 20% reduction

- name: Case 1, below 171 percent FPG, no reduction.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 3_500
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    ct_tfa: 833

- name: Case 2, above 171 percent FPG, gets 20 percent reduction.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 3_600
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # 833 * 0.8 = 666.4
    ct_tfa: 666.4

- name: Case 3, unearned income deducted from payment.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 200
    tanf_gross_earned_income: 1_000
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # 833 - 200 = 633
    ct_tfa: 633

- name: Case 4, unearned income exceeds payment, benefit zero.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 900
    tanf_gross_earned_income: 500
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # max(833 - 900, 0) = 0
    ct_tfa: 0

- name: Case 5, high earner with unearned income.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 133
    tanf_gross_earned_income: 3_600
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # (833 - 133) * 0.8 = 700 * 0.8 = 560
    ct_tfa: 560

- name: Case 6, high earner with unearned exceeding payment, zero floor.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 900
    tanf_gross_earned_income: 3_600
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # max(833 - 900, 0) * 0.8 = 0 * 0.8 = 0
    ct_tfa: 0

- name: Case 7, not eligible.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    ct_tfa_eligible: false
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 100
    tanf_gross_earned_income: 500
    state_code: CT
  output:
    ct_tfa: 0

# --- Pre-2024 test (before high-earnings provision took effect) ---
# The high_earnings/rate parameter starts at 2024-01-01. The formula uses
# an if-check (p.rate > 0) so the reduction does not apply before 2024.

- name: Case 8, 2023 low earner no high-earnings reduction.
  period: 2023-01
  absolute_error_margin: 0.1
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 1_000
    state_code: CT
  output:
    # Statewide amount extrapolated: size 3 = $833
    ct_tfa_payment_standard: 833
    ct_tfa: 833

# --- Regional period benefit test (pre-2022) ---

- name: Case 9, 2020 regional period Region B benefit.
  period: 2020-01
  absolute_error_margin: 0.1
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 500
    state_code: CT
  output:
    # Region B (default), size 3 = $597
    ct_tfa_payment_standard: 597
    ct_tfa: 597

- name: Case 10, 2020 regional period Region A with unearned income.
  period: 2020-01
  absolute_error_margin: 0.1
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 100
    tanf_gross_earned_income: 200
    ct_tfa_region: REGION_A
    state_code: CT
  output:
    # Region A, size 3 = $698
    ct_tfa_payment_standard: 698
    # 698 - 100 = 598
    ct_tfa: 598

# --- Housing subsidy tests (CGS ยง 17b-104(d)) ---
# Families in subsidized housing receive 92% of payment standard.

- name: Case 11, housing subsidy reduces payment standard.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 1_000
    receives_housing_assistance: true
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # 833 * 0.92 = 766.36
    ct_tfa: 766.36

- name: Case 12, housing subsidy with unearned income.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 200
    tanf_gross_earned_income: 1_000
    receives_housing_assistance: true
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # 833 * 0.92 - 200 = 766.36 - 200 = 566.36
    ct_tfa: 566.36

- name: Case 13, housing subsidy with high earner reduction.
  period: 2024-01
  absolute_error_margin: 0.3
  input:
    ct_tfa_eligible: true
    spm_unit_size: 3
    ct_tfa_countable_unearned_income: 0
    tanf_gross_earned_income: 3_600
    receives_housing_assistance: true
    state_code: CT
  output:
    ct_tfa_payment_standard: 833
    # 833 * 0.92 = 766.36, then * 0.8 = 613.088
    ct_tfa: 613.09

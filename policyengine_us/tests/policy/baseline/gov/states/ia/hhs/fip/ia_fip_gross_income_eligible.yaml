# Unit tests for Iowa FIP gross income eligibility (Test 1)
# IAC 441-41.27(239B): Gross income <= 185% of Standard of Need
# https://www.law.cornell.edu/regulations/iowa/Iowa-Admin-Code-r-441-41-27
#
# 185% thresholds by family size:
#   Size 1: $365 * 1.85 = $675.25
#   Size 2: $719 * 1.85 = $1,330.15
#   Size 3: $849 * 1.85 = $1,570.65
#   Size 4: $986 * 1.85 = $1,824.10
#   Size 5: $1,092 * 1.85 = $2,020.20

- name: Case 1, no income, family of 2.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: IA
  output:
    # Family size: 2
    # Gross income: $0
    # 185% threshold: $719 * 1.85 = $1,330.15
    # $0 <= $1,330.15 -> eligible
    ia_fip_gross_income_eligible: true

- name: Case 2, income below 185% threshold, family of 3.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month
      person2:
        age: 7
      person3:
        age: 4
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: IA
  output:
    # Family size: 3
    # Gross income: $1,000/month
    # 185% threshold: $849 * 1.85 = $1,570.65
    # $1,000 <= $1,570.65 -> eligible
    ia_fip_gross_income_eligible: true

- name: Case 3, income above 185% threshold, family of 3.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month
      person2:
        age: 7
      person3:
        age: 4
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: IA
  output:
    # Family size: 3
    # Gross income: $2,000/month
    # 185% threshold: $849 * 1.85 = $1,570.65
    # $2,000 > $1,570.65 -> ineligible
    ia_fip_gross_income_eligible: false

- name: Case 4, income at exact 185% threshold, family of 2.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        # ~$1,330.15/month * 12 = $15,961.79/year
        # Note: Using 15_961.79 instead of 15_961.80 to avoid float32
        # precision at the exact boundary ($15,961.80/12 = $1,330.15
        # in float64, but float32 rounds to $1,330.1500244 which
        # exceeds the threshold).
        employment_income_before_lsr: 15_961.79
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: IA
  output:
    # Family size: 2
    # Gross income: $15,961.79 / 12 = ~$1,330.149/month
    # 185% threshold: $719 * 1.85 = $1,330.15
    # ~$1,330.149 <= $1,330.15 -> eligible (at threshold)
    ia_fip_gross_income_eligible: true

- name: Case 5, income just above 185% threshold, family of 2.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        # $1,331/month * 12 = $15,972/year
        employment_income_before_lsr: 15_972
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: IA
  output:
    # Family size: 2
    # Gross income: $15,972 / 12 = $1,331/month
    # 185% threshold: $719 * 1.85 = $1,330.15
    # $1,331 > $1,330.15 -> ineligible
    ia_fip_gross_income_eligible: false

- name: Case 6, combined earned and unearned income, family of 4.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 35
        employment_income_before_lsr: 12_000  # $1,000/month earned
        social_security: 3_600  # $300/month unearned
      person2:
        age: 33
      person3:
        age: 10
      person4:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: IA
  output:
    # Family size: 4
    # Gross income: $1,000 + $300 = $1,300/month
    # 185% threshold: $986 * 1.85 = $1,824.10
    # $1,300 <= $1,824.10 -> eligible
    ia_fip_gross_income_eligible: true

- name: Case 7, single person, income above threshold.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 9_600  # $800/month
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: IA
  output:
    # Family size: 1
    # Gross income: $800/month
    # 185% threshold: $365 * 1.85 = $675.25
    # $800 > $675.25 -> ineligible
    ia_fip_gross_income_eligible: false

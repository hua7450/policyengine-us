# Tests for in_tanf_countable_earned_income_for_eligibility
# Enrolled (months 1-4): $90/earner + $30 flat + 1/3 disregard
# Enrolled (months 5-12): $90/earner + $30 flat only
# Applicant (not enrolled): $90/earner only

# --- Continuing recipients (enrolled, January = month 1, phase 1) ---

- name: Case 1, enrolled family of 3 with 1 earner.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 400
      person2:
        tanf_gross_earned_income: 0
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [187.6, 187.6, 187.6]
    # $400 - $90 = $310
    # $310 - $30 = $280
    # $280 * 0.67 = $187.60

- name: Case 2, enrolled family of 3 with 2 earners.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 200
      person2:
        tanf_gross_earned_income: 200
      person3:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [127.3, 127.3, 127.3]
    # Person1: $200 - $90 = $110
    # Person2: $200 - $90 = $110
    # Unit total: $220
    # $220 - $30 = $190
    # $190 * 0.67 = $127.30

- name: Case 3, enrolled single earner with low income.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 300
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [120.6, 120.6]
    # $300 - $90 = $210
    # $210 - $30 = $180
    # $180 * 0.67 = $120.60

- name: Case 4, enrolled earner below work expense disregard.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 50
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [0, 0]
    # $50 - $90 = max(0, -40) = $0

- name: Case 5, enrolled with zero income.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [0, 0]

# --- Applicants (not enrolled, $90 work expense only) ---

- name: Case 6, applicant with 1 earner.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 400
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: false
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [310, 310]
    # $400 - $90 = $310 (no $30 or 1/3 for applicants)

- name: Case 7, applicant with low income.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 300
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: false
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [210, 210]
    # $300 - $90 = $210

- name: Case 8, applicant below work expense.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 50
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: false
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [0, 0]
    # $50 - $90 = max(0, -40) = $0

# --- YEAR period (exercises both calendar month paths) ---

- name: Case 9, enrolled over full year.
  period: 2024
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 4_800
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [2_990.4, 2_990.4]
    # Monthly gross: $4,800 / 12 = $400
    # $400 - $90 = $310, then $310 - $30 = $280
    # Months 1-4 (phase 1): $280 * 0.67 = $187.60 x 4 = $750.40
    # Months 5-12 (phase 2): $280 x 8 = $2,240.00
    # Annual total: $750.40 + $2,240.00 = $2,990.40

- name: Case 10, applicant over full year.
  period: 2024
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 4_800
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: false
    households:
      household:
        members: [person1, person2]
        state_code: IN
  output:
    in_tanf_countable_earned_income_for_eligibility: [3_720, 3_720]
    # Monthly gross: $4,800 / 12 = $400
    # All 12 months: $400 - $90 = $310
    # Annual total: $310 x 12 = $3,720

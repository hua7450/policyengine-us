# Kentucky K-TAP Historical and Boundary Tests
# Tests verify parameter values across three eras:
#   ERA 1: Pre-2023 (1997-07-01 to 2023-02-28) - frozen AFDC-era values
#   ERA 2: Post-2023 overhaul (2023-03-01 to 2025-10-31)
#   ERA 3: November 2025 reduction (2025-11-01+)
# Sources:
#   - 921 KAR 2:016 (pre-2023): apps.legislature.ky.gov/law/kar/titles/921/002/016/10142/
#   - 921 KAR 2:016 (current): apps.legislature.ky.gov/law/kar/titles/921/002/016/

###############################################################################
# ERA 1: Pre-2023 Payment Maximums (all sizes 1-7)
###############################################################################

- name: Case 1, pre-2023 payment maximum size 1.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 186

- name: Case 2, pre-2023 payment maximum size 2.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 225

- name: Case 3, pre-2023 payment maximum size 3.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 262

- name: Case 4, pre-2023 payment maximum size 4.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 328

- name: Case 5, pre-2023 payment maximum size 5.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 383

- name: Case 6, pre-2023 payment maximum size 6.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 432

- name: Case 7, pre-2023 payment maximum size 7.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
      person7: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 482

###############################################################################
# ERA 1: Pre-2023 Standard of Need (all sizes 1-7)
###############################################################################

- name: Case 8, pre-2023 standard of need size 1.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 401

- name: Case 9, pre-2023 standard of need size 2.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 460

- name: Case 10, pre-2023 standard of need size 3.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 526

- name: Case 11, pre-2023 standard of need size 4.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 592

- name: Case 12, pre-2023 standard of need size 5.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 658

- name: Case 13, pre-2023 standard of need size 6.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 724

- name: Case 14, pre-2023 standard of need size 7.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
      person7: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7]
        state_code: KY
  output:
    ky_ktap_standard_of_need: 790

###############################################################################
# ERA 1: Pre-2023 Resource Limit ($2,000)
###############################################################################

- name: Case 15, pre-2023 resource eligible at limit.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 2_000
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_resource_eligible: true

- name: Case 16, pre-2023 resource ineligible above limit.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
    spm_units:
      spm_unit:
        members: [person1]
        spm_unit_assets: 2_001
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_resource_eligible: false

###############################################################################
# ERA 1: Pre-2023 Earned Income Disregard ($30 + 1/3 formula)
# Formula: after_work = max(gross - $90, 0)
#          flat = $30, remainder = max(after_work - $30, 0)
#          disregard = $30 + 0.333 * remainder
#          countable = max(after_work - disregard, 0)
###############################################################################

- name: Case 17, pre-2023 EID with zero earned income.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $0 gross, after work expense = $0, countable = $0
    ky_ktap_countable_earned_income: 0

- name: Case 18, pre-2023 EID with income below work expense.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 50
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $50 - $90 work expense = $0 (capped at 0)
    ky_ktap_countable_earned_income: 0

- name: Case 19, pre-2023 EID with income at work expense.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 90
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $90 - $90 work expense = $0
    ky_ktap_countable_earned_income: 0

- name: Case 20, pre-2023 EID with income below flat disregard after work expense.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 100
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $100 - $90 work expense = $10
    # $10 < $30 flat disregard, so entirely disregarded
    # disregard = $30 + 0.333 * max($10 - $30, 0) = $30
    # countable = max($10 - $30, 0) = $0
    ky_ktap_countable_earned_income: 0

- name: Case 21, pre-2023 EID with income at flat disregard after work expense.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 120
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $120 - $90 work expense = $30
    # $30 = $30 flat disregard, remainder = $0
    # disregard = $30 + 0.333 * $0 = $30
    # countable = max($30 - $30, 0) = $0
    ky_ktap_countable_earned_income: 0

- name: Case 22, pre-2023 EID with income just above flat disregard.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 150
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $150 - $90 work expense = $60
    # remainder = max($60 - $30, 0) = $30
    # disregard = $30 + 0.333 * $30 = $30 + $9.99 = $39.99
    # countable = max($60 - $39.99, 0) = $20.01
    ky_ktap_countable_earned_income: 20.01

- name: Case 23, pre-2023 EID with typical earned income.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 600
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $600 - $90 work expense = $510
    # remainder = max($510 - $30, 0) = $480
    # disregard = $30 + 0.333 * $480 = $30 + $159.84 = $189.84
    # countable = max($510 - $189.84, 0) = $320.16
    ky_ktap_countable_earned_income: 320.16

###############################################################################
# Post-2023 EID (50% formula) â€” verify same scenarios give different results
# Formula: after_work = max(gross - $175, 0)
#          disregard = 0.5 * after_work
#          countable = 0.5 * after_work
###############################################################################

- name: Case 24, post-2023 EID with zero earned income.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 0
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_countable_earned_income: 0

- name: Case 25, post-2023 EID with income below work expense.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 100
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $100 - $175 work expense = $0
    ky_ktap_countable_earned_income: 0

- name: Case 26, post-2023 EID with typical earned income.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 600
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $600 - $175 work expense = $425
    # 50% disregard: $425 * 0.5 = $212.50
    ky_ktap_countable_earned_income: 212.5

###############################################################################
# ERA 1: Pre-2023 Work Expense ($90 vs $175)
###############################################################################

- name: Case 27, pre-2023 work expense is $90.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_earned_income: 200
    spm_units:
      spm_unit:
        members: [person1]
        childcare_expenses: 0
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $200 - $90 work expense = $110
    # remainder = max($110 - $30, 0) = $80
    # disregard = $30 + 0.333 * $80 = $30 + $26.64 = $56.64
    # countable = max($110 - $56.64, 0) = $53.36
    ky_ktap_countable_earned_income: 53.36

###############################################################################
# ERA 3: November 2025 Payment Maximums (all sizes 1-7)
###############################################################################

- name: Case 28, Nov 2025 payment maximum size 1.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
    spm_units:
      spm_unit:
        members: [person1]
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 242

- name: Case 29, Nov 2025 payment maximum size 2.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 293

- name: Case 30, Nov 2025 payment maximum size 3.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 341

- name: Case 31, Nov 2025 payment maximum size 4.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4]
    households:
      household:
        members: [person1, person2, person3, person4]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 426

- name: Case 32, Nov 2025 payment maximum size 5.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5]
    households:
      household:
        members: [person1, person2, person3, person4, person5]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 498

- name: Case 33, Nov 2025 payment maximum size 6.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 562

- name: Case 34, Nov 2025 payment maximum size 7.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
      person4: {}
      person5: {}
      person6: {}
      person7: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3, person4, person5, person6, person7]
    households:
      household:
        members: [person1, person2, person3, person4, person5, person6, person7]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 627

###############################################################################
# Period transition boundaries
###############################################################################

# First full year of K-TAP (1998)
- name: Case 35, 1998 first full year uses ERA 1 payment max.
  period: 1998-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 262
    ky_ktap_standard_of_need: 526

# Last month of pre-2023 era
- name: Case 36, Jan 2023 last pre-2023 month uses ERA 1 values.
  period: 2023-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 262
    ky_ktap_standard_of_need: 526

# Post-2023 era (already tested in other files, but verify here)
- name: Case 37, 2024 uses ERA 2 values.
  period: 2024-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    ky_ktap_payment_maximum: 524
    ky_ktap_standard_of_need: 631

# Post-Nov 2025 reduction
- name: Case 38, 2026 uses ERA 3 payment max but ERA 2 standard of need.
  period: 2026-01
  absolute_error_margin: 0.1
  input:
    people:
      person1: {}
      person2: {}
      person3: {}
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Payment max reduced in ERA 3; standard of need unchanged
    ky_ktap_payment_maximum: 341
    ky_ktap_standard_of_need: 631

###############################################################################
# Pre-2023 Integration: full pipeline at ERA 1 boundary
###############################################################################

- name: Case 39, pre-2023 integration, family of 3, no income.
  period: 2022
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income: 0
      person2:
        age: 8
      person3:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Family size 3 in ERA 1
    ky_ktap_standard_of_need: 526 * 12
    ky_ktap_payment_maximum: 262 * 12
    ky_ktap_countable_earned_income: 0
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 0
    # Gross income $0 < $973 limit (526 * 1.85 = 973.1)
    ky_ktap_income_eligible: true
    # Assets $0 <= $2,000 limit
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Per KRS 205.200(2): no income -> payment_maximum
    # $262/month * 12 = $3,144
    ky_ktap: 262 * 12

- name: Case 40, pre-2023 integration, family of 2 with earned income.
  period: 2022
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 28
        # $600/month = $7,200/year
        employment_income_before_lsr: 7_200
      person2:
        age: 6
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    # Family size 2 in ERA 1
    ky_ktap_standard_of_need: 460 * 12
    ky_ktap_payment_maximum: 225 * 12
    # Monthly earned: $600 - $90 work expense = $510
    # remainder = max($510 - $30, 0) = $480
    # disregard = $30 + 0.333 * $480 = $189.84
    # countable = $510 - $189.84 = $320.16/month
    # Annual: $320.16 * 12 = $3,841.92
    ky_ktap_countable_earned_income: 320.16 * 12
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 320.16 * 12
    # Gross income: $600/mo < $851 limit (460 * 1.85 = 851)
    ky_ktap_income_eligible: true
    # Assets $500 <= $2,000 limit
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Deficit: $460 need - $320.16 countable = $139.84
    # Benefit: min(0.55 * $139.84, $225) = min($76.912, $225) = $76.912/month
    # Annual: $76.912 * 12 = $922.944
    ky_ktap: 76.912 * 12

###############################################################################
# ERA 3 Integration: full pipeline at Nov 2025 reduction
###############################################################################

- name: Case 41, ERA 3 integration, family of 3, no income.
  period: 2026
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        employment_income: 0
      person2:
        age: 8
      person3:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Family size 3, ERA 3
    # Standard of need unchanged from ERA 2
    ky_ktap_standard_of_need: 631 * 12
    # Payment maximum reduced
    ky_ktap_payment_maximum: 341 * 12
    ky_ktap_countable_earned_income: 0
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 0
    # Gross income $0 < $1,167 limit (631 * 1.85 = 1167.35)
    ky_ktap_income_eligible: true
    # Assets $0 <= $10,000 limit (ERA 2+ resource limit)
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Per KRS 205.200(2): no income -> payment_maximum
    # $341/month * 12 = $4,092
    ky_ktap: 341 * 12

- name: Case 42, ERA 3 integration, family of 2 with earned income.
  period: 2026
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 28
        # $600/month = $7,200/year
        employment_income_before_lsr: 7_200
      person2:
        age: 6
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 500
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    # Family size 2, ERA 3
    ky_ktap_standard_of_need: 552 * 12
    ky_ktap_payment_maximum: 293 * 12
    # Monthly earned: $600 - $175 work expense = $425
    # 50% disregard: $425 * 0.5 = $212.50
    # Annual: $212.50 * 12 = $2,550
    ky_ktap_countable_earned_income: 212.5 * 12
    ky_ktap_countable_unearned_income: 0
    ky_ktap_countable_income: 212.5 * 12
    # Gross income: $600/mo < $1,021 limit (552 * 1.85 = 1021.2)
    ky_ktap_income_eligible: true
    # Assets $500 <= $10,000
    ky_ktap_resource_eligible: true
    ky_ktap_eligible: true
    # Deficit: $552 need - $212.50 countable = $339.50
    # Benefit: min(0.55 * $339.50, $293) = min($186.725, $293) = $186.725/month
    # Annual: $186.725 * 12 = $2,240.70
    ky_ktap: 186.725 * 12

###############################################################################
# Pre-2023 Unearned Income ($50 child support disregard unchanged)
###############################################################################

- name: Case 43, pre-2023 child support disregard is $50.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        tanf_gross_unearned_income: 300
        child_support_received: 1_200
    households:
      household:
        members: [person1]
        state_code: KY
  output:
    # $300 gross - min($100/mo, $50) = $300 - $50 = $250
    ky_ktap_countable_unearned_income: 250

###############################################################################
# Pre-2023 Income Eligibility
###############################################################################

- name: Case 44, pre-2023 income eligible at lower limit.
  period: 2022
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        # $700/month = $8,400/year
        employment_income_before_lsr: 8_400
      person2:
        age: 10
      person3:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Gross income: $700/mo
    # Limit: 526 * 1.85 = $973.1/mo = $11,677/yr
    # $700/mo < $973.1 limit -> eligible
    ky_ktap_income_eligible: true

- name: Case 45, pre-2023 income ineligible above limit.
  period: 2022
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        # $1,000/month = $12,000/year
        employment_income_before_lsr: 12_000
      person2:
        age: 10
      person3:
        age: 7
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
    households:
      household:
        members: [person1, person2, person3]
        state_code: KY
  output:
    # Gross income: $1,000/mo
    # Limit: 526 * 1.85 = $973.1/mo = $11,677/yr
    # $1,000/mo > $973.1 limit -> ineligible
    ky_ktap_income_eligible: false

###############################################################################
# Pre-2023 Dependent Care Disregard (unchanged from ERA 2)
###############################################################################

- name: Case 46, pre-2023 dependent care disregard uses same caps.
  period: 2022-01
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
      person2:
        age: 5
    spm_units:
      spm_unit:
        members: [person1, person2]
        childcare_expenses: 3_600
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    # Max for age 5: $175/month, actual: $300/month
    # Disregard = min($300, $175) = $175
    ky_ktap_dependent_care_disregard: 175

###############################################################################
# Pre-2023 Benefit Rate (0.55 unchanged)
###############################################################################

- name: Case 47, pre-2023 benefit rate is 55 percent.
  period: 2022
  absolute_error_margin: 0.1
  input:
    people:
      person1:
        age: 30
        # $200/month = $2,400/year (low income to ensure some benefit calc)
        employment_income_before_lsr: 2_400
      person2:
        age: 6
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 0
    households:
      household:
        members: [person1, person2]
        state_code: KY
  output:
    # Family size 2, ERA 1
    ky_ktap_standard_of_need: 460 * 12
    ky_ktap_payment_maximum: 225 * 12
    # Monthly earned: $200 - $90 work = $110
    # remainder = max($110 - $30, 0) = $80
    # disregard = $30 + 0.333 * $80 = $30 + $26.64 = $56.64
    # countable_earned = max($110 - $56.64, 0) = $53.36/month
    ky_ktap_countable_earned_income: 53.36 * 12
    ky_ktap_countable_income: 53.36 * 12
    # Deficit: $460 - $53.36 = $406.64
    # Benefit: min(0.55 * $406.64, $225) = min($223.652, $225) = $223.652/month
    # Annual: $223.652 * 12 = $2,683.824
    ky_ktap: 223.652 * 12

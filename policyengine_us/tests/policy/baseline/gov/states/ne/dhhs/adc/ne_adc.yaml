# Nebraska ADC Benefit Amount Edge Cases
# These test specific edge cases NOT covered in integration.yaml
#
# Gap Budgeting Methodology:
#   Step 1: Net Earned Income = Gross Earned * (1 - disregard_rate)
#   Step 2: Gap = Need Standard - Net Earned Income
#   Step 3: Benefit = min(Gap, Payment Standard)
#   Step 4: Final Benefit = Benefit - Unearned Income

# =============================================================================
# EDGE CASES - GAP BUDGETING
# =============================================================================

- name: Edge case, gap less than payment standard benefit equals gap.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 8_400  # $700/month -> $350 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 843
    ne_adc_payment_standard: 464
    ne_adc_countable_earned_income: 350
    # Gross = $700, after 50% disregard = $350
    ne_adc_maximum_benefit: 464
    # Gap = $843 - $350 = $493
    # Benefit = min($493, $463.65) = $463.65 (gap > payment standard)
    ne_adc: 464

- name: Edge case, gap greater than payment standard benefit equals payment standard.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 843
    ne_adc_payment_standard: 464
    ne_adc_countable_earned_income: 0
    ne_adc_maximum_benefit: 464
    # Gap = $843 - $0 = $843
    # Benefit = min($843, $463.65) = $463.65 (gap > payment standard)
    ne_adc: 464

# =============================================================================
# EDGE CASES - UNEARNED INCOME
# =============================================================================

- name: Edge case, unearned income exactly wipes out max benefit.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 5_568  # $464/month unearned >= payment standard
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_payment_standard: 464
    ne_adc_maximum_benefit: 464
    # Gap = $843 - $0 = $843
    # Benefit = min($843, $463.65) = $463.65
    ne_adc: 0
    # Final = $463.65 - $464 = -$0.35 -> $0

- name: Edge case, unearned income exceeds max benefit no negative.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
        social_security: 6_000  # $500/month unearned > payment standard
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_payment_standard: 464
    ne_adc_maximum_benefit: 464
    ne_adc: 0
    # Final = $463.65 - $500 = -$36.35 -> $0 (no negative benefits)

# =============================================================================
# EDGE CASES - STATE RESIDENCY
# =============================================================================

- name: Edge case, non-Nebraska state returns zero benefit.
  # Family in Texas should get zero Nebraska ADC benefit
  period: 2024-01
  absolute_error_margin: 0.5
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        spm_unit_assets: 1_000
    households:
      household:
        members: [person1, person2]
        state_code: TX
  output:
    ne_adc: 0
    # Family in Texas, not Nebraska -> ne_adc benefit is $0

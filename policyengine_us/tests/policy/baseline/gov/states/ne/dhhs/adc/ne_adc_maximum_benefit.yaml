# Nebraska ADC Maximum Benefit Tests
# Gap Budgeting Formula:
#   Gap = max(Need Standard - Countable Earned Income, 0)
#   Maximum Benefit = min(Gap, Payment Standard)
#
# NOTE: This is BEFORE unearned income deduction (final benefit subtracts unearned)

- name: Case 1, zero income gap exceeds payment standard.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 0
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 843
    ne_adc_payment_standard: 464
    ne_adc_countable_earned_income: 0
    ne_adc_maximum_benefit: 464
    # Gap = $843 - $0 = $843
    # Benefit = min($843, $463.65) = $463.65

- name: Case 2, income reduces gap below payment standard.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 8_400  # $700/month -> $350 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 843
    ne_adc_payment_standard: 464
    ne_adc_countable_earned_income: 350
    ne_adc_maximum_benefit: 464
    # Gap = $843 - $350 = $493
    # Benefit = min($493, $463.65) = $463.65

- name: Case 3, high income negative gap becomes zero.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 24_000  # $2,000/month -> $1,000 countable
      person2:
        age: 10
    spm_units:
      spm_unit:
        members: [person1, person2]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2]
        state_code: NE
  output:
    ne_adc_need_standard: 843
    ne_adc_countable_earned_income: 1_000
    ne_adc_maximum_benefit: 0
    # Gap = $843 - $1,000 = -$157 -> max(-157, 0) = $0
    # Benefit = min($0, $463.65) = $0

- name: Case 4, larger family higher standards.
  period: 2024-01
  absolute_error_margin: 1
  input:
    people:
      person1:
        age: 30
        employment_income_before_lsr: 12_000  # $1,000/month -> $500 countable
      person2:
        age: 10
      person3:
        age: 8
    spm_units:
      spm_unit:
        members: [person1, person2, person3]
        is_tanf_enrolled: true
    households:
      household:
        members: [person1, person2, person3]
        state_code: NE
  output:
    ne_adc_need_standard: 1_003
    ne_adc_payment_standard: 552
    ne_adc_countable_earned_income: 500
    ne_adc_maximum_benefit: 503
    # Gap = $1,003 - $500 = $503
    # Benefit = min($503, $551.65) = $503

- name: Case 1, senior single filer with property taxes gets increased max credit.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 65
        real_estate_taxes: 5_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # Senior with $0 AGI, eligible, gets full $1,000 (min of taxes paid and cap)
    ct_property_tax_credit: 1_000

- name: Case 2, senior single filer with high AGI phases down to minimum floor.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 65
        employment_income: 200_000
        real_estate_taxes: 5_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # Senior single with AGI $200k, exceeds $130k threshold by $70k
    # 7 increments * 15% = 105% reduction, but minimum floor is $400
    ct_property_tax_credit: 400

- name: Case 3, senior joint filers below new threshold get full credit.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 68
        employment_income: 100_000
        real_estate_taxes: 2_000
      person2:
        age: 66
        employment_income: 80_000
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # Joint seniors with AGI $180k, below $200k threshold, gets full credit
    # Credit = min(property_taxes, cap) = min($2,000, $1,000) = $1,000
    ct_property_tax_credit: 1_000

- name: Case 4, senior joint filers above threshold get reduced credit with floor.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 70
        employment_income: 150_000
        real_estate_taxes: 3_000
      person2:
        age: 68
        employment_income: 150_000
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # Senior joint with AGI $300k, exceeds $200k threshold by $100k
    # 10 increments * 15% = 150% reduction, but minimum floor is $400
    ct_property_tax_credit: 400

- name: Case 5, filer with dependent gets credit with floor for low property taxes.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 40
        real_estate_taxes: 200
      child1:
        age: 10
    tax_units:
      tax_unit:
        members: [person1, child1]
        filing_status: HEAD_OF_HOUSEHOLD
    households:
      household:
        members: [person1, child1]
        state_code: CT
  output:
    # HoH with dependent, low property taxes $200
    # Credit = min($200, $1,000) = $200, but minimum floor is $400
    ct_property_tax_credit: 400

- name: Case 6, non-CT resident gets zero credit.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 65
        real_estate_taxes: 5_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: NY
  output:
    ct_property_tax_credit: 0

- name: Case 7, younger filer with property taxes gets credit (age threshold is 0 since 2022).
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.hb5009.ct_hb5009.ct_hb5009
  input:
    people:
      person1:
        age: 30
        real_estate_taxes: 5_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # Since 2022, age threshold is 0 so all CT filers qualify
    ct_property_tax_credit: 1_000

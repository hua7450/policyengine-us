- name: Case 1, single filer qualifying for SB-100 reduced rates.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 50_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $50k < $100k threshold -> qualifies for SB-100
    # Exemption: $15k phased out ($50k > $30k + $15k)
    # Taxable income: $50,000
    # SB-100 tax: $0-$10k@0% + $10k-$50k@3% = $0 + $1,200 = $1,200
    # Add-back: $0 (AGI $50k < $56,500 start)
    # Personal credit: 10% * $1,200 = $120
    # Final: $1,200 - $120 = $1,080
    ct_income_tax_after_personal_credits: 1_080

- name: Case 2, single filer not qualifying due to high AGI.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 100_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $100k = $100k threshold -> does NOT qualify (strict <)
    # Standard rates: $0-$10k@2% + $10k-$50k@4.5% + $50k-$100k@5.5%
    #   = $200 + $1,800 + $2,750 = $4,750
    # Add-back: ceil(($100k - $56.5k) / $5k) * $25 = 9 * $25 = $225
    # Total: $4,750 + $225 = $4,975
    # Personal credit: 0% (AGI > $64,500)
    # Final: $4,975
    ct_income_tax_after_personal_credits: 4_975

- name: Case 3, joint filers qualifying for SB-100 reduced rates.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 75_000
      person2:
        age: 38
        employment_income: 75_000
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # AGI $150k < $200k threshold -> qualifies for SB-100
    # Exemption: $24k phased out ($150k > $48k + $24k)
    # Taxable income: $150,000
    # SB-100 tax: $0-$20k@0% + $20k-$100k@3% + $100k-$150k@5.5%
    #   = $0 + $2,400 + $2,750 = $5,150
    # Add-back: ceil(($150k - $100.5k) / $5k) * $50 = 10 * $50 = $500
    # Total: $5,150 + $500 = $5,650
    # Personal credit: 0% (AGI > joint credit threshold)
    # Final: $5,650
    ct_income_tax_after_personal_credits: 5_650

- name: Case 4, joint filers not qualifying due to high AGI.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 100_000
      person2:
        age: 38
        employment_income: 100_000
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # AGI $200k = $200k threshold -> does NOT qualify (strict <)
    # Standard rates: $0-$20k@2% + $20k-$100k@4.5% + $100k-$200k@5.5%
    #   = $400 + $3,600 + $5,500 = $9,500
    # Add-back: ceil(($200k - $100.5k) / $5k) * $50 = max $500
    # Total: $9,500 + $500 = $10,000
    # Personal credit: 0%
    # Final: $10,000
    ct_income_tax_after_personal_credits: 10_000

- name: Case 5, head of household qualifying for SB-100 reduced rates.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 80_000
      person2:
        age: 10
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: HEAD_OF_HOUSEHOLD
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # AGI $80k < $100k threshold -> qualifies for SB-100
    # Exemption: $19k phased out ($80k > $38k + $19k)
    # Taxable income: $80,000
    # SB-100 tax: $0-$16k@0% + $16k-$80k@3% = $0 + $1,920 = $1,920
    # Add-back: ceil(($80k - $78.5k) / $4k) * $40 = 1 * $40 = $40
    # Total: $1,920 + $40 = $1,960
    # Personal credit: 0% (AGI > HoH credit threshold)
    # Final: $1,960
    ct_income_tax_after_personal_credits: 1_960

- name: Case 6, head of household not qualifying due to high AGI.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 110_000
      person2:
        age: 10
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: HEAD_OF_HOUSEHOLD
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # AGI $110k >= $100k threshold -> does NOT qualify
    # Standard rates: $0-$16k@2% + $16k-$80k@4.5% + $80k-$110k@5.5%
    #   = $320 + $2,880 + $1,650 = $4,850
    # Add-back: ceil(($110k - $78.5k) / $4k) * $40 = 8 * $40 = $320
    # Total: $4,850 + $320 = $5,170
    # Personal credit: 0%
    # Final: $5,170
    ct_income_tax_after_personal_credits: 5_170

- name: Case 7, non-CT resident gets zero CT tax.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 50_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: NY
  output:
    ct_income_tax_after_personal_credits: 0

- name: Case 8, single filer just below AGI threshold qualifies.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 99_999
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $99,999 < $100k threshold -> qualifies for SB-100
    # SB-100 tax: $0-$10k@0% + $10k-$50k@3% + $50k-$99,999@5.5%
    #   = $0 + $1,200 + $2,749.95 = $3,949.95
    # Add-back: ceil(($99,999 - $56,500) / $5,000) * $25 = 9 * $25 = $225
    # Total: $3,949.95 + $225 = $4,174.95
    # Personal credit: 0%
    # Final: $4,175
    ct_income_tax_after_personal_credits: 4_175

- name: Case 9, joint filers just below AGI threshold qualifies.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 99_999
      person2:
        age: 38
        employment_income: 99_999
    tax_units:
      tax_unit:
        members: [person1, person2]
        filing_status: JOINT
    households:
      household:
        members: [person1, person2]
        state_code: CT
  output:
    # AGI $199,998 < $200k threshold -> qualifies for SB-100
    # SB-100 tax: $0-$20k@0% + $20k-$100k@3% + $100k-$199,998@5.5%
    #   = $0 + $2,400 + $5,499.89 = $7,899.89
    # Add-back: max $500
    # Total: $7,899.89 + $500 = $8,399.89
    # Personal credit: 0%
    # Final: $8,400
    ct_income_tax_after_personal_credits: 8_400

- name: Case 10, single filer with income spanning into 3rd bracket.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 80_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SINGLE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $80k < $100k threshold -> qualifies for SB-100
    # Taxable income: $80,000
    # SB-100 tax: $0-$10k@0% + $10k-$50k@3% + $50k-$80k@5.5%
    #   = $0 + $1,200 + $1,650 = $2,850
    # Add-back: ceil(($80k - $56.5k) / $5k) * $25 = 5 * $25 = $125
    # Total: $2,850 + $125 = $2,975
    # Personal credit: 0% (AGI > $64,500)
    # Final: $2,975
    ct_income_tax_after_personal_credits: 2_975

- name: Case 11, separate filer qualifying for SB-100 reduced rates.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 80_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SEPARATE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $80k < $100k threshold -> qualifies for SB-100
    # Exemption: $12k phased out ($80k > $24k + $12k)
    # Taxable income: $80,000
    # SB-100 tax: $0-$10k@0% + $10k-$50k@3% + $50k-$80k@5.5%
    #   = $0 + $1,200 + $1,650 = $2,850
    # Add-back: ceil(($80k - $50.25k) / $2.5k) * $25 = 12 * $25 = max $250
    # Total: $2,850 + $250 = $3,100
    # Personal credit: 0%
    # Final: $3,100
    ct_income_tax_after_personal_credits: 3_100

- name: Case 12, separate filer not qualifying due to high AGI.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 110_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SEPARATE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $110k >= $100k threshold -> does NOT qualify
    # Standard rates: $0-$10k@2% + $10k-$50k@4.5% + $50k-$100k@5.5%
    #   + $100k-$110k@6% = $200 + $1,800 + $2,750 + $600 = $5,350
    # Add-back: max $250
    # Recapture: ceil(($110k - $105k) / $5k) * $25 = 1 * $25 = $25
    # Total: $5,350 + $250 + $25 = $5,625
    # Personal credit: 0%
    # Final: $5,625
    ct_income_tax_after_personal_credits: 5_625

- name: Case 13, surviving spouse qualifying for SB-100 reduced rates.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 150_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SURVIVING_SPOUSE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $150k < $200k threshold -> qualifies for SB-100
    # Exemption: $24k phased out ($150k > $48k + $24k)
    # Taxable income: $150,000
    # SB-100 tax: $0-$20k@0% + $20k-$100k@3% + $100k-$150k@5.5%
    #   = $0 + $2,400 + $2,750 = $5,150
    # Add-back: ceil(($150k - $100.5k) / $5k) * $50 = 10 * $50 = $500
    # Total: $5,150 + $500 = $5,650
    # Personal credit: 0%
    # Final: $5,650
    ct_income_tax_after_personal_credits: 5_650

- name: Case 14, surviving spouse not qualifying due to high AGI.
  absolute_error_margin: 1
  period: 2026
  reforms: policyengine_us.reforms.states.ct.sb100.ct_sb100.ct_sb100
  input:
    people:
      person1:
        age: 40
        employment_income: 210_000
    tax_units:
      tax_unit:
        members: [person1]
        filing_status: SURVIVING_SPOUSE
    households:
      household:
        members: [person1]
        state_code: CT
  output:
    # AGI $210k >= $200k threshold -> does NOT qualify
    # Standard rates: $0-$20k@2% + $20k-$100k@4.5% + $100k-$200k@5.5%
    #   + $200k-$210k@6% = $400 + $3,600 + $5,500 + $600 = $10,100
    # Add-back: max $500
    # Total: $10,100 + $500 = $10,600
    # Personal credit: 0%
    # Final: $10,600
    ct_income_tax_after_personal_credits: 10_600
